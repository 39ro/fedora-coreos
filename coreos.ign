{
  "ignition": {
    "version": "3.4.0"
  },
  "passwd": {
    "users": [
      {
        "groups": [
          "wheel"
        ],
        "name": "core",
        "sshAuthorizedKeys": [
          "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIDixgmi6yxyYmkok37WUtOr6x1R2kGcsUsST5ewC7Xjh nousername"
        ]
      }
    ]
  },
  "storage": {
    "files": [
      {
        "path": "/etc/hostname",
        "contents": {
          "compression": "",
          "source": "data:,k8s-node"
        },
        "mode": 420
      },
      {
        "path": "/etc/yum.repos.d/kubernetes.repo",
        "contents": {
          "compression": "gzip",
          "source": "data:;base64,H4sIAAAAAAAC/5TMzarCMBDF8f08TIZy70IKeQIfQUTS9pDK5GPIpGLfXupC3Lo757/4XWSb0Ao67EolZPjzJ9AUDFtLfu1dbWRWiebkZO5eea4NI1sPU8LIj8H9/XPTzIRypMUPFDXOK2bxAzVovX39qFGw/wQfxBJ6eI+8uGdOTrDTKwAA//+Pu71GwgAAAA=="
        },
        "mode": 420
      },
      {
        "path": "/etc/modules-load.d/k8s.conf",
        "contents": {
          "compression": "",
          "source": "data:,overlay%0Abr_netfilter%0A"
        },
        "mode": 420
      },
      {
        "path": "/etc/sysctl.d/k8s.conf",
        "contents": {
          "compression": "gzip",
          "source": "data:;base64,H4sIAAAAAAAC/8pLLdFLKspMSU+FUrp5abrJiTk5upkFZiWJSTmpxQq2CoZc+NShKcssKDPRyyyIT8svKk8sSgGLAwIAAP//5C49v2cAAAA="
        },
        "mode": 420
      },
      {
        "path": "/etc/kubernetes/kubeadm-config.yaml",
        "contents": {
          "compression": "gzip",
          "source": "data:;base64,H4sIAAAAAAAC/4yPsWrEMAyGdz+Fud32pZTjGuhQburQpQfdnURnhH1SkOU0j1+S69Spi0DiF9/3xxm/QCoy9Ta3AeJ09/lcPXJYugE0PpuMNPX2nVAvTDdMTaIikyGe4BMSVn0cemPtKHjlMYP29tAI1z6EsEQJ0iiMgrwPX3nMB+OcM//GX0qrCvLHAPSbJSOljT3zdG0D7ezu5cl3p7M/+mPoTgczMqlwKSAfkWIC2R5gVYlvkuq2WOusc7cCq1u4tDu4ubSEVN2E8rqXKDiETbKAhkfmN2J+AgAA//+mB1/DRgEAAA=="
        },
        "mode": 420
      },
      {
        "path": "/var/lib/kubelet/config.yaml",
        "contents": {
          "compression": "",
          "source": "data:,apiVersion%3A%20kubelet.config.k8s.io%2Fv1beta1%0Akind%3A%20KubeletConfiguration%0AcgroupDriver%3A%20systemd%0AcontainerRuntimeEndpoint%3A%20%22unix%3A%2F%2F%2Fvar%2Frun%2Fcrio%2Fcrio.sock%22%0A"
        },
        "mode": 420
      },
      {
        "path": "/var/lib/kubelet/kubeadm-flags.env",
        "contents": {
          "compression": "",
          "source": "data:,KUBELET_KUBEADM_ARGS%3D%22--config%3D%2Fvar%2Flib%2Fkubelet%2Fconfig.yaml%22%0A"
        },
        "mode": 420
      }
    ]
  },
  "systemd": {
    "units": [
      {
        "contents": "[Unit]\nDescription=Install Kubernetes packages\nRequires=rpm-ostreed.service\nAfter=rpm-ostreed.service network-online.target\nWants=network-online.target\nConditionPathExists=!/var/lib/%N.stamp\n\n[Service]\nType=oneshot\nExecStart=/usr/bin/rpm-ostree install cri-o kubelet kubeadm kubectl\nExecStartPost=/usr/bin/touch /var/lib/%N.stamp\n\n[Install]\nWantedBy=multi-user.target\n",
        "enabled": true,
        "name": "install-k8s.service"
      },
      {
        "contents": "[Unit]\nDescription=Initialize Kubernetes cluster\nAfter=rpm-ostreed.service network-online.target\nWants=network-online.target\nRequires=crio.service kubelet.service\nAfter=crio.service kubelet.service\nConditionPathExists=!/etc/kubernetes/admin.conf\n\n[Service]\nType=oneshot\nExecStart=/usr/bin/kubeadm init --config /etc/kubernetes/kubeadm-config.yaml\n\n[Install]\nWantedBy=multi-user.target\n",
        "enabled": true,
        "name": "kubeadm-init.service"
      },
      {
        "enabled": true,
        "name": "crio.service"
      },
      {
        "enabled": true,
        "name": "kubelet.service"
      },
      {
        "enabled": true,
        "name": "qemu-guest-agent.service"
      }
    ]
  }
}
